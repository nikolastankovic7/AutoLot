<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Projekat Internet programiranje</title>

    <!-- Linkovanje Bootstrap-a -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/">Početna</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="/pretrazi">Pretrazivanje</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/dodajPlac">Dodaj Autoplac</a>
            </li>
        </ul>
    </div>
</nav>
<style>
    .sredina
    {
        display: block;
        margin-left: 320px;
        margin-right: 320px;
    }
    .dugme
    {
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

</style>
<br>

<div class="sredina">
            <div class="row">

                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <input type="text" class="form-control"  id="nazivdrzave" placeholder="Unesite naziv drzave ili adresu">
                </div>
                <div class="col-m4-4">
                    <input type="button" class="btn btn-info" id="pretraga" value="Pretraži">
                </div>
            </div>
        </div>
    </div>

</div>

<div class="container my-4">
    <h3 class="text-center mb-3">Autoplacevi</h3>
    <section id="prikaz">
        <div class="row bg-dark text-light font-weight-bold">
            <div class="col-md-2 p-3 text-center border border-light">ID placa</div>
            <div class="col-md-2 p-3 text-center border border-light">Ime placa</div>
            <div class="col-md-3 p-3 text-center border border-light">Adresa</div>
            <div class="col-md-2 p-3 text-center border border-light">Drzava</div>
            <div class="col-md-3 p-3 text-center border border-light">Automobili</div>
        </div>
        <div class="row" style="background-color: #f0f5f5;">
            {{#each podaci}}
                <div class="col-md-2 p-3 text-center border border-dark"><a href="/izmeni/{{this.id}}">Izmeni</a></div>
                <div class="col-md-2 p-3 text-center border border-dark">{{this.imeAutoPlaca}}</div>
                <div class="col-md-3 p-3 text-center border border-dark">{{this.adresa}}</div>
                <div class="col-md-2 p-3 text-center border border-dark">{{this.drzava}}</div>
                <div class="col-md-3 p-3 text-center border border-dark">
                    <ol>
                        {{#each this.automobili}}
                            <li>{{this.marka}}</li>
                            <p>Model: {{this.model}}</p>
                            <p>Godiste: {{this.godiste}}</p>
                            <p>Cena: {{this.cena}}</p>
                        {{/each}}
                    </ol>
                </div>
            {{/each}}
        </div>
    </section>

</div>


<!-- Dodavanje javascript Bootstrap-a -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<!-- Dodavanje JQuery biblioteke -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    let prikazAuta = document.querySelector("#prikaz");
    function prikazFiltriranihPlaceva(lista) {
        prikazAuta.innerHTML = ``;
        let html = "";
        html += `
                <div class="row bg-dark text-light font-weight-bold">
                <div class="col-md-2 p-3 text-center border border-light">ID placa</div>
            <div class="col-md-2 p-3 text-center border border-light">Ime placa</div>
            <div class="col-md-3 p-3 text-center border border-light">Adresa</div>
            <div class="col-md-2 p-3 text-center border border-light">Drzava</div>
            <div class="col-md-3 p-3 text-center border border-light">Automobili</div>
                </div>
                <div class="row" style="background-color: #f0f5f5;">
            `;
        for(let i = 0; i < lista.length; i++){
            html += `
                    <div class="col-md-2 p-3 text-center border border-dark">${lista[i].id}</div>
                <div class="col-md-2 p-3 text-center border border-dark">${lista[i].imeAutoPlaca}</div>
                <div class="col-md-3 p-3 text-center border border-dark">${lista[i].adresa}</div>
                <div class="col-md-2 p-3 text-center border border-dark">${lista[i].drzava}</div>
                    <div class="col-md-3 p-3 text-center border border-dark">

                `;
            for(let j = 0; j < lista[i].automobili.length;j++){
                html += `


                            <p>${lista[i].automobili[j].marka}</p>
                            <p>Model: ${lista[i].automobili[j].model}</p>
                            <p>Godiste: ${lista[i].automobili[j].godiste}</p>
                            <p>Cena: ${lista[i].automobili[j].cena}</p>


                    `;
            }
            html += `

                    </div>
                `;
        }
        html += `
                </div>
            `;
        prikazAuta.innerHTML = html;
    }
    let btnPretraga = document.querySelector("#pretraga");
    let polje = document.querySelector("#nazivdrzave");
    let drzava = document.querySelector("drzava");
    btnPretraga.addEventListener("click",function() {
     $.ajax({
        url:"/api/pretrazi",
        method:"POST",
         data:{
            "drzava":polje.value,
             "adresa":polje.value
         },
         success:function (lista) {
            if(lista.length>0)
            {
                prikazFiltriranihPlaceva(lista);
                console.log(lista);
            }

         }
     });
    });
</script>
</body>
</html>